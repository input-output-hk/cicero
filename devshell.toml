imports = [
  "language.go"
]

[[env]]
name = "DATABASE_URL"
value = "postgres://postgres:@127.0.0.1:5432/cicero?sslmode=disable"

[[env]]
name = "CICERO_WORKFLOW_SRC"
value = "."

[[env]]
name = "LOKI_ADDR"
value = "http://127.0.0.1:3100"

[[env]]
name = "CONSOLE_LOGGING_ENABLED"
value = true

[[env]]
name = "ENCODE_LOGS_AS_JSON"
value = true

[[env]]
name = "FILE_LOGGING_ENABLED"
value = false

[[env]]
name = "LOGS_DIRECTORY"
value = "logs"

[[env]]
name = "LOGS_FILE_NAME"
value = "cicero.log"

[[env]]
name = "LOGS_MAX_SIZE"
value = "10"

[[env]]
name = "LOGS_MAX_BACKUPS"
value = "10"

[[env]]
name = "LOGS_MAX_AGE"
value = "10"

[[commands]]
package = "go"

[[commands]]
package = "dbmate"

[[commands]]
package = "golangci-lint"

[[commands]]
package = "liftbridge-cli"

[[commands]]
package = "liftbridge"

[[commands]]
package = "gouml"

[[commands]]
package = "nomad"

[[commands]]
package = "damon"

[[commands]]
name = "lint"
command = "golangci-lint run && gocritic check -enableAll ./... && fd -e nix -X nixfmt -c"
help = "Run code linters"

[[commands]]
package = "nomad-dev"
help = "Run Nomad in development mode with Nix driver"

[[commands]]
name = "psqlc"
command = "psql -d \"$DATABASE_URL\" \"$@\""
help = "psql into Cicero DB"

[[commands]]
name = "dev-run"
command = "cue export ./jobs -e jobs.dev | nomad run -"
help = "run postgres, loki, and liftbridge in nomad"

[devshell]
name = "cicero"
packages = [
  "cicero-evaluator-nix",
  "cue",
  "diffutils",
  "fd",
  "gcc",
  "go",
  "gocode",
  "gocritic",
  "goimports",
  "gopls",
  "grafana-loki",
  "nixfmt",
  "nomad-follower",
  "postgresql_12",
  "sqliteInteractive",
  "vector",
]
